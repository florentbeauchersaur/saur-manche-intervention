<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAUR MANCHE - Gestion Maintenance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #2c3e50; }
        
        .sidebar { position: fixed; left: 0; top: 0; width: 280px; height: 100vh; background: linear-gradient(180deg, #0066b3 0%, #004d87 100%); color: white; padding: 24px; box-shadow: 4px 0 12px rgba(0,0,0,0.1); z-index: 1000; overflow-y: auto; }
        .logo { font-size: 40px; font-weight: 900; letter-spacing: 4px; margin-bottom: 8px; text-align: center; }
        .logo-subtitle { text-align: center; font-size: 13px; opacity: 0.9; margin-bottom: 32px; font-weight: 500; }
        .menu-item { padding: 14px 18px; margin: 8px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 12px; font-size: 15px; font-weight: 500; }
        .menu-item:hover { background: rgba(255,255,255,0.15); transform: translateX(4px); }
        .menu-item.active { background: rgba(255,255,255,0.25); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .menu-item i { font-size: 18px; width: 24px; }
        
        .main-content { margin-left: 280px; padding: 24px; min-height: 100vh; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .page-header { background: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .page-header h1 { font-size: 28px; color: #0066b3; margin-bottom: 8px; }
        .page-header p { color: #7f8c8d; font-size: 14px; }
        
        .card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 24px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .stat-card { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,102,179,0.3); }
        .stat-card h3 { font-size: 32px; margin-bottom: 8px; }
        .stat-card p { opacity: 0.9; font-size: 14px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        thead { position: sticky; top: 0; background: #f8fafc; z-index: 10; }
        th { padding: 14px 12px; text-align: left; font-weight: 600; color: #0066b3; border-bottom: 2px solid #e2e8f0; white-space: nowrap; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        tbody tr:hover { background: #f8fafc; }
        
        .editable-cell { cursor: pointer; padding: 8px; border-radius: 4px; transition: all 0.2s; min-width: 80px; display: inline-block; }
        .editable-cell:hover { background: #eff6ff; border: 1px solid #3b82f6; }
        
        .badge { padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; display: inline-block; }
        .priority-critique { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; }
        .priority-haute { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .priority-moyenne { background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%); color: white; }
        .priority-basse { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; box-shadow: 0 4px 12px rgba(0,102,179,0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,102,179,0.4); }
        .btn-secondary { background: #e2e8f0; color: #334155; }
        .btn-secondary:hover { background: #cbd5e1; }
        .btn-danger { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; }
        
        .btn-icon { padding: 8px; width: 36px; height: 36px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; border: none; }
        .btn-icon:hover { transform: scale(1.1); }
        .btn-edit { background: #3b82f6; color: white; }
        .btn-archive { background: #f59e0b; color: white; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 32px; max-width: 1200px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s; }
        @keyframes modalSlideIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e2e8f0; }
        .modal-header h2 { color: #0066b3; font-size: 24px; }
        .close-modal { font-size: 28px; cursor: pointer; color: #94a3b8; transition: all 0.2s; }
        .close-modal:hover { color: #dc2626; transform: rotate(90deg); }
        
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 24px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full { grid-column: 1 / -1; }
        .form-group label { font-weight: 600; margin-bottom: 8px; color: #475569; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea { padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; transition: all 0.2s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #0066b3; box-shadow: 0 0 0 3px rgba(0,102,179,0.1); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        
        .filters { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .filters input, .filters select { padding: 10px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
        .filters input { flex: 1; min-width: 250px; }
        
        .activity-feed { position: fixed; top: 80px; right: 24px; width: 380px; max-height: 500px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); border: 2px solid #0066b3; z-index: 999; display: none; }
        .activity-feed.active { display: block; animation: slideInRight 0.4s; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        
        .activity-header { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; padding: 16px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .activity-header h3 { font-size: 16px; }
        .activity-list { max-height: 400px; overflow-y: auto; padding: 16px; }
        .activity-item { padding: 12px; border-left: 3px solid #0066b3; background: #f8fafc; margin-bottom: 12px; border-radius: 6px; animation: fadeIn 0.3s; }
        .activity-item-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .activity-item-header i { color: #0066b3; }
        .activity-item-title { font-weight: 600; color: #1e293b; font-size: 13px; }
        .activity-item-message { color: #64748b; font-size: 12px; margin-bottom: 4px; }
        .activity-item-meta { display: flex; justify-content: space-between; font-size: 11px; color: #94a3b8; }
        
        .chat-widget { position: fixed; bottom: 24px; right: 24px; z-index: 1000; }
        .chat-button { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; border: none; cursor: pointer; box-shadow: 0 6px 20px rgba(0,102,179,0.4); font-size: 24px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .chat-button:hover { transform: scale(1.1); box-shadow: 0 8px 24px rgba(0,102,179,0.5); }
        
        .chat-window { display: none; position: fixed; bottom: 100px; right: 24px; width: 380px; height: 500px; background: white; border-radius: 16px; box-shadow: 0 12px 40px rgba(0,0,0,0.2); flex-direction: column; animation: slideUp 0.3s; }
        .chat-window.active { display: flex; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .chat-header { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; padding: 16px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; background: #f8fafc; }
        .message { margin-bottom: 12px; padding: 12px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .message-author { font-weight: 600; color: #0066b3; font-size: 12px; margin-bottom: 4px; }
        .message-content { color: #334155; font-size: 13px; }
        .chat-input { display: flex; padding: 16px; border-top: 1px solid #e2e8f0; }
        .chat-input input { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; margin-right: 8px; }
        
        .ge-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .ge-icon { font-size: 48px; color: #0066b3; }
        .ge-tabs { display: flex; gap: 12px; margin-bottom: 24px; }
        .ge-tab { padding: 12px 24px; background: #e2e8f0; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .ge-tab.active { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; }
        
        .ge-badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; display: inline-block; }
        .ge-badge-fait { background: #22c55e; color: white; }
        .ge-badge-encours { background: #f59e0b; color: white; }
        .ge-badge-oui { background: #0066b3; color: white; }
        .ge-badge-non { background: #dc2626; color: white; }
        
        .agents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .agent-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #0066b3; }
        .agent-card h3 { color: #0066b3; margin-bottom: 8px; }
        .agent-card p { color: #64748b; font-size: 14px; }
        
        .notification { position: fixed; top: 24px; right: 24px; background: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); border-left: 4px solid #0066b3; z-index: 9999; display: none; min-width: 300px; animation: slideInRight 0.4s; }
        .notification.active { display: block; }
        .notification-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .notification-icon { font-size: 20px; color: #0066b3; }
        .notification-title { font-weight: 600; color: #1e293b; }
        .notification-message { color: #64748b; font-size: 13px; }
        
        .secteurs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .secteur-card { background: linear-gradient(135deg, #0066b3 0%, #004d87 100%); color: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,102,179,0.3); }
        .secteur-card h3 { font-size: 24px; margin-bottom: 12px; }
        .secteur-card p { opacity: 0.9; margin-bottom: 8px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">SAUR</div>
    <div class="logo-subtitle">Maintenance MANCHE</div>
    
    <div class="menu-item active" onclick="app.showPage('dashboard')">
        <i class="fas fa-home"></i><span>Dashboard</span>
    </div>
    <div class="menu-item" onclick="app.showPage('interventions')">
        <i class="fas fa-wrench"></i><span>Interventions</span>
    </div>
    <div class="menu-item" onclick="app.showPage('archives')">
        <i class="fas fa-archive"></i><span>Archives</span>
    </div>
    <div class="menu-item" onclick="app.showPage('groupes')">
        <i class="fas fa-bolt"></i><span>Groupes √âlectrog√®nes</span>
    </div>
    <div class="menu-item" onclick="app.showPage('agents')">
        <i class="fas fa-users"></i><span>Agents</span>
    </div>
    <div class="menu-item" onclick="app.showPage('secteurs')">
        <i class="fas fa-map-marked-alt"></i><span>Secteurs</span>
    </div>
    <div class="menu-item" onclick="app.showPage('parametres')">
        <i class="fas fa-cog"></i><span>Param√®tres</span>
    </div>
</div>

<div class="main-content">
    <div id="dashboard" class="page active">
        <div class="page-header">
            <h1><i class="fas fa-home"></i> Dashboard</h1>
            <p>Vue d'ensemble des interventions</p>
        </div>
        <div class="stats-grid" id="statsGrid"></div>
        <div class="card">
            <h2 style="margin-bottom: 16px; color: #0066b3;"><i class="fas fa-exclamation-triangle"></i> Interventions Critiques</h2>
            <div id="criticalInterventions"></div>
        </div>
    </div>

    <div id="interventions" class="page">
        <div class="page-header">
            <h1><i class="fas fa-wrench"></i> Interventions</h1>
            <p>78 FIM actives</p>
        </div>
        <div class="card">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2 style="color: #0066b3;">Liste des FIM <span id="fimCount" style="color: #22c55e;"></span></h2>
                <button class="btn btn-primary" onclick="app.openModal()">
                    <i class="fas fa-plus"></i> Nouvelle FIM
                </button>
            </div>
            <div class="filters">
                <input type="text" id="searchIntervention" placeholder="üîç Rechercher..." onkeyup="app.renderInterventions()">
                <select id="filterType" onchange="app.renderInterventions()">
                    <option value="">Tous types</option>
                    <option value="EU">EU</option>
                    <option value="AEP">AEP</option>
                </select>
                <select id="filterPriorite" onchange="app.renderInterventions()">
                    <option value="">Toutes priorit√©s</option>
                    <option value="Critique">Critique</option>
                    <option value="Haute">Haute</option>
                    <option value="Moyenne">Moyenne</option>
                    <option value="Basse">Basse</option>
                </select>
                <select id="filterStatut" onchange="app.renderInterventions()">
                    <option value="">Tous statuts</option>
                    <option value="En pr√©paration">En pr√©paration</option>
                    <option value="En attente">En attente</option>
                    <option value="En cours">En cours</option>
                    <option value="Termin√©">Termin√©</option>
                </select>
                <select id="filterSecteur" onchange="app.renderInterventions()">
                    <option value="">Tous secteurs</option>
                    <option value="Cotentin">Cotentin</option>
                    <option value="Bessin">Bessin</option>
                    <option value="Sud Manche">Sud Manche</option>
                </select>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>FIM</th>
                            <th>Libell√©</th>
                            <th>Site</th>
                            <th>Mat√©riel</th>
                            <th>Type</th>
                            <th>Priorit√©</th>
                            <th>Statut</th>
                            <th>Secteur</th>
                            <th>Ordonnanceur</th>
                            <th>Agent(s)</th>
                            <th>Date Signal.</th>
                            <th>Date R√©alis.</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="interventionsBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="archives" class="page">
        <div class="page-header">
            <h1><i class="fas fa-archive"></i> Archives</h1>
            <p>FIM archiv√©es</p>
        </div>
        <div class="card">
            <h2 style="margin-bottom: 20px; color: #0066b3;">FIM Archiv√©es</h2>
            <div class="filters">
                <input type="text" id="searchArchive" placeholder="üîç Rechercher..." onkeyup="app.renderArchives()">
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr><th>FIM</th><th>Site</th><th>Mat√©riel</th><th>Type</th><th>Date R√©alis.</th><th>Actions</th></tr>
                    </thead>
                    <tbody id="archivesBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="groupes" class="page">
        <div class="page-header">
            <div class="ge-header">
                <i class="fas fa-bolt ge-icon"></i>
                <div>
                    <h1>Groupes √âlectrog√®nes</h1>
                    <p>37 groupes r√©partis sur 3 r√©gions</p>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="ge-tabs">
                <button class="ge-tab active" onclick="app.showGE('MANCHE BESSIN')">MANCHE BESSIN (19)</button>
                <button class="ge-tab" onclick="app.showGE('CALVADOS')">CALVADOS (14)</button>
                <button class="ge-tab" onclick="app.showGE('ORNE')">ORNE (8)</button>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Puissance</th>
                            <th>Site</th>
                            <th>Entretien 2025</th>
                            <th>Dernier entretien</th>
                            <th>Dernier travaux</th>
                            <th>Dernier d√©pannage</th>
                            <th>Heures fonct.</th>
                        </tr>
                    </thead>
                    <tbody id="geBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="agents" class="page">
        <div class="page-header">
            <h1><i class="fas fa-users"></i> Agents de Maintenance</h1>
            <p>4 agents pour interventions</p>
        </div>
        <div class="agents-grid">
            <div class="agent-card">
                <h3><i class="fas fa-user"></i> MARIE Emmanuel</h3>
                <p><i class="fas fa-bolt"></i> D√©pannage √âlectro</p>
            </div>
            <div class="agent-card">
                <h3><i class="fas fa-user"></i> CAVE Pascal</h3>
                <p><i class="fas fa-bolt"></i> D√©pannage √âlectro</p>
            </div>
            <div class="agent-card">
                <h3><i class="fas fa-user"></i> AUDE Baptiste</h3>
                <p><i class="fas fa-bolt"></i> D√©pannage √âlectro</p>
            </div>
            <div class="agent-card">
                <h3><i class="fas fa-user"></i> TRAVERS Julien</h3>
                <p><i class="fas fa-wrench"></i> D√©pannage Monteur</p>
            </div>
        </div>
    </div>

    <div id="secteurs" class="page">
        <div class="page-header">
            <h1><i class="fas fa-map-marked-alt"></i> Secteurs</h1>
            <p>3 secteurs g√©ographiques</p>
        </div>
        <div class="secteurs-grid">
            <div class="secteur-card">
                <h3><i class="fas fa-map-pin"></i> COTENTIN</h3>
                <p><strong>Chef:</strong> Guillaume DEGRUGILLIER</p>
            </div>
            <div class="secteur-card">
                <h3><i class="fas fa-map-pin"></i> BESSIN</h3>
                <p><strong>Chef:</strong> Antoine DUMAS</p>
            </div>
            <div class="secteur-card">
                <h3><i class="fas fa-map-pin"></i> SUD MANCHE</h3>
                <p><strong>Chef:</strong> Guillaume SAUVAGET</p>
            </div>
        </div>
    </div>

    <div id="parametres" class="page">
        <div class="page-header">
            <h1><i class="fas fa-cog"></i> Param√®tres</h1>
            <p>R√©serv√© administrateur</p>
        </div>
        <div id="parametresContent"></div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle"><i class="fas fa-plus-circle"></i> Nouvelle FIM</h2>
            <span class="close-modal" onclick="app.closeModal()">&times;</span>
        </div>
        <form id="interventionForm" onsubmit="app.saveIntervention(event)">
            <input type="hidden" id="editingId">
            <div class="form-grid">
                <div class="form-group"><label>N¬∞ FIM *</label><input type="text" id="fim" required></div>
                <div class="form-group"><label>Type *</label><select id="type" required><option value="EU">EU</option><option value="AEP">AEP</option></select></div>
                <div class="form-group full"><label>Libell√© *</label><input type="text" id="libelle" required></div>
                <div class="form-group"><label>Site *</label><input type="text" id="site" required></div>
                <div class="form-group"><label>Mat√©riel *</label><input type="text" id="materiel" required></div>
                <div class="form-group"><label>Priorit√© *</label><select id="priorite" required><option value="Critique">Critique</option><option value="Haute">Haute</option><option value="Moyenne">Moyenne</option><option value="Basse">Basse</option></select></div>
                <div class="form-group"><label>Statut *</label><select id="statut" required><option value="En pr√©paration">En pr√©paration</option><option value="En attente">En attente</option><option value="En cours">En cours</option><option value="Termin√©">Termin√©</option></select></div>
                <div class="form-group"><label>Secteur *</label><select id="secteur" required><option value="Cotentin">Cotentin</option><option value="Bessin">Bessin</option><option value="Sud Manche">Sud Manche</option></select></div>
                <div class="form-group"><label>Ordonnanceur</label><select id="ordonnanceur"><option value="">---</option><option value="Aur√©lie LEFRANCOIS">Aur√©lie LEFRANCOIS</option><option value="Christophe ROTH">Christophe ROTH</option></select></div>
                <div class="form-group"><label>Agent(s)</label><select id="agents" multiple style="height: 100px;"><option value="MARIE Emmanuel">MARIE Emmanuel</option><option value="CAVE Pascal">CAVE Pascal</option><option value="AUDE Baptiste">AUDE Baptiste</option><option value="TRAVERS Julien">TRAVERS Julien</option></select><small style="color: #64748b;">Ctrl/Cmd pour s√©lection multiple</small></div>
                <div class="form-group"><label>Date Signalement</label><input type="date" id="dateSignalement"></div>
                <div class="form-group"><label>Date Planifi√©e</label><input type="date" id="datePlanifiee"></div>
                <div class="form-group"><label>Date R√©alisation</label><input type="date" id="dateRealisation"></div>
                <div class="form-group full"><label>Description</label><textarea id="probleme"></textarea></div>
                <div class="form-group full"><label>Compte Rendu</label><textarea id="compteRendu"></textarea></div>
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Annuler</button>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<div id="activityFeed" class="activity-feed active">
    <div class="activity-header">
        <h3><i class="fas fa-clock"></i> Activit√©</h3>
        <span class="close-modal" onclick="app.toggleActivityFeed()" style="color: white; font-size: 20px;">&times;</span>
    </div>
    <div class="activity-list" id="activityList"></div>
</div>

<div class="chat-widget">
    <button class="chat-button" onclick="app.toggleChat()"><i class="fas fa-comments"></i></button>
    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <h3><i class="fas fa-comments"></i> Discussion</h3>
            <span class="close-modal" onclick="app.toggleChat()" style="color: white; font-size: 20px;">&times;</span>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Message..." onkeypress="if(event.key==='Enter') app.sendMessage()">
            <button class="btn btn-primary" onclick="app.sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<div id="notification" class="notification"></div>

<script>
window.app={data:{interventions:[],messages:[],activities:[],groupesElectrogenes:{},settings:{notifications:!0,activityFeed:!0}},currentPage:"dashboard",currentUser:"Florent BEAUCHER",currentGE:"MANCHE BESSIN",chatOpen:!1,init(){this.loadData(),this.render(),this.renderActivityFeed(),this.renderChat(),setInterval(()=>{this.data.settings.autoSave&&this.saveData()},3e4)},loadData(){const t=localStorage.getItem("saur_interventions");t?this.data.interventions=JSON.parse(t):this.loadInitialFIM();const e=localStorage.getItem("saur_messages");e&&(this.data.messages=JSON.parse(e));const a=localStorage.getItem("saur_activities");a&&(this.data.activities=JSON.parse(a));const s=localStorage.getItem("saur_settings");s&&(this.data.settings=JSON.parse(s)),this.loadGroupesElectrogenes()},loadInitialFIM(){const t=(new Date).toISOString().split("T")[0],e=new Date;e.setDate(e.getDate()-30);const a=e.toISOString().split("T")[0];this.data.interventions=[{id:Date.now()+1,fim:"2025001",libelle:"D√©pannage urgent",site:"STEP Portbail",materiel:"Seepex",type:"EU",priorite:"Haute",statut:"En cours",secteur:"Cotentin",ordonnanceur:"",agents:"",dateSignalement:a,datePlanifiee:t,dateRealisation:"",probleme:"Probl√®me seepex (automate, sonde etc)",compteRendu:"",archive:!1,createdAt:(new Date).toISOString(),createdBy:this.currentUser,updatedAt:(new Date).toISOString(),updatedBy:this.currentUser},{id:Date.now()+2,fim:"2025002",libelle:"Maintenance pr√©ventive",site:"STEP Portbail",materiel:"Agitateur BA",type:"EU",priorite:"Moyenne",statut:"En attente",secteur:"Cotentin",ordonnanceur:"Aur√©lie LEFRANCOIS",agents:"",dateSignalement:a,datePlanifiee:t,dateRealisation:"",probleme:"Agitateur BA en attente de renou (Laurent VASSE)",compteRendu:"",archive:!1,createdAt:(new Date).toISOString(),createdBy:this.currentUser,updatedAt:(new Date).toISOString(),updatedBy:this.currentUser},{id:Date.now()+3,fim:"2025003",libelle:"Panne critique",site:"STEP Portbail",materiel:"Surpresseur secours",type:"EU",priorite:"Critique",statut:"En pr√©paration",secteur:"Cotentin",ordonnanceur:"Christophe ROTH",agents:"MARIE Emmanuel",dateSignalement:a,datePlanifiee:t,dateRealisation:"",probleme:"Surpresseur secours qui ne fonctionne pas (Micka√´l)",compteRendu:"",archive:!1,createdAt:(new Date).toISOString(),createdBy:this.currentUser,updatedAt:(new Date).toISOString(),updatedBy:this.currentUser}],this.saveData()},loadGroupesElectrogenes(){this.data.groupesElectrogenes={"MANCHE BESSIN":[{puissance:"44 KVA",site:"STEP Barneville Carteret (mobile)",entretien2025:"Oui",dernierEntretien:"26/08/2024",dernierTravaux:"20/11/2024",dernierDepannage:"",heures:0},{puissance:"220 KVA",site:"STEP Barneville Carteret",entretien2025:"Oui",dernierEntretien:"26/08/2024",dernierTravaux:"20/11/2024",dernierDepannage:"24/07/2024",heures:0},{puissance:"65 KVA",site:"PR 17 Aubert Portbail",entretien2025:"Oui",dernierEntretien:"23/08/2024",dernierTravaux:"20/11/2024",dernierDepannage:"",heures:0},{puissance:"195 KVA",site:"STEP de Portbail",entretien2025:"Oui",dernierEntretien:"04/06/2024",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"135 KVA",site:"Production Breuville (mobile)",entretien2025:"Oui",dernierEntretien:"11/07/2024",dernierTravaux:"11/07/2024",dernierDepannage:"",heures:0},{puissance:"375 KVA",site:"STEP d'Agon Coutainville",entretien2025:"Oui",dernierEntretien:"26/09/2024",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"66 KVA",site:"STEP de P√©riers (PR Principal)",entretien2025:"Oui",dernierEntretien:"13/09/2023",dernierTravaux:"02/04/2024",dernierDepannage:"",heures:0},{puissance:"16 KVA",site:"PR DIP Linverville - Gouville sur Mer",entretien2025:"Oui",dernierEntretien:"13/04/2023",dernierTravaux:"12/11/2024",dernierDepannage:"",heures:0},{puissance:"550 KVA",site:"STEP de Pirou",entretien2025:"Oui",dernierEntretien:"",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"100 KVA",site:"STEP de Lessay",entretien2025:"Oui",dernierEntretien:"23/08/2024",dernierTravaux:"31/12/2024",dernierDepannage:"",heures:0},{puissance:"15 KVA",site:"PR n¬∞15 Rue des Fosses - Saint Germain sur Aye",entretien2025:"Non",dernierEntretien:"",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"88 KVA",site:"STEP de Grandcamp Maisy",entretien2025:"Oui",dernierEntretien:"23/02/2023",dernierTravaux:"",dernierDepannage:"25/02/2025",heures:0},{puissance:"110 KVA",site:"Forages de Lessay",entretien2025:"Oui",dernierEntretien:"22/02/2024",dernierTravaux:"10/07/2024",dernierDepannage:"24/07/2024",heures:0},{puissance:"200 KVA",site:"Forages F1 et F4 des Marais - Saint Germain sur S√®ve",entretien2025:"Oui",dernierEntretien:"24/09/2024",dernierTravaux:"10/04/2025",dernierDepannage:"12/08/2025",heures:0},{puissance:"140 KVA",site:"F6 D√©carbonation et surpression SYMPEC (mobile)",entretien2025:"Oui",dernierEntretien:"29/08/2024",dernierTravaux:"05/12/2024",dernierDepannage:"",heures:0},{puissance:"1400 KVA",site:"Decarbonstation et surpression SYMPEC",entretien2025:"Oui",dernierEntretien:"29/08/2024",dernierTravaux:"22/07/2024",dernierDepannage:"",heures:0},{puissance:"30 KVA",site:"Surpression de Grandcamp Maisy",entretien2025:"Oui",dernierEntretien:"29/08/2024",dernierTravaux:"13/12/2024",dernierDepannage:"",heures:0},{puissance:"66 KVA",site:"Reprise de Grandcamp Maisy",entretien2025:"Oui",dernierEntretien:"23/09/2024",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"22 KVA",site:"B√¢ches Surpression des Champs Fran√ßais de Caumont l'√âvent√©",entretien2025:"Oui",dernierEntretien:"09/08/2024",dernierTravaux:"30/08/2024",dernierDepannage:"19/12/2024",heures:0}],CALVADOS:[{puissance:"30 KVA",site:"STEP de VERSON",entretien2025:"Fait",dernierEntretien:"04/11/2025",dernierTravaux:"28/11/2024",dernierDepannage:"",heures:0},{puissance:"30 KVA",site:"PR du camping - Asnelles",entretien2025:"En cours",dernierEntretien:"10/02/2023",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"63 KVA",site:"STEP de Ver sur Mer",entretien2025:"En cours",dernierEntretien:"22/08/2024",dernierTravaux:"06/12/2024",dernierDepannage:"",heures:0},{puissance:"95 KVA",site:"STEP de Basly (THAON)",entretien2025:"Fait",dernierEntretien:"04/11/2025",dernierTravaux:"28/11/2024",dernierDepannage:"",heures:0},{puissance:"100 KVA",site:"STEP d'Argences",entretien2025:"En cours",dernierEntretien:"03/09/2024",dernierTravaux:"14/01/2025",dernierDepannage:"",heures:0},{puissance:"250 KVA",site:"STEP de Ranville",entretien2025:"Fait",dernierEntretien:"05/11/2025",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"250 KVA",site:"STEP de Ouistreham",entretien2025:"Fait",dernierEntretien:"05/11/2025",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"220 KVA",site:"Usine de Surpression et R√©servoir SIAEP Colombelles",entretien2025:"En cours",dernierEntretien:"",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"400 KVA",site:"Bache et reprise de la Mue - Usine de production THAON",entretien2025:"Fait",dernierEntretien:"04/11/2025",dernierTravaux:"11/04/2025",dernierDepannage:"26/09/2025",heures:0},{puissance:"715 KVA",site:"Pole de regroupement de la Gronde - Giberville",entretien2025:"En cours",dernierEntretien:"03/09/2024",dernierTravaux:"09/01/2025",dernierDepannage:"",heures:0},{puissance:"220 KVA",site:"Pole de regroupement de Lebisey - H√âROUVILLE ST CLAIR",entretien2025:"Fait",dernierEntretien:"03/11/2025",dernierTravaux:"",dernierDepannage:"18/10/2024",heures:0},{puissance:"440 KVA",site:"Usine de d√©carbonatation - H√©rouville Saint Clair",entretien2025:"Fait",dernierEntretien:"03/11/2025",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"130 KVA",site:"Forages F6-F7-F8 - H√©rouville Saint Clair",entretien2025:"Fait",dernierEntretien:"03/11/2025",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"40 KVA",site:"Surpression et b√¢che - ST CONTEST",entretien2025:"En cours",dernierEntretien:"03/01/2023",dernierTravaux:"",dernierDepannage:"",heures:0}],ORNE:[{puissance:"220 KVA",site:"Production ultrafiltration reprise la Trigardiere - Anciens (Station)",entretien2025:"Oui",dernierEntretien:"11/03/2024",dernierTravaux:"10/07/2024",dernierDepannage:"",heures:0},{puissance:"77 KVA",site:"Production ultrafiltration reprise la Trigardiere - Anciens (Chateau d'eau)",entretien2025:"Oui",dernierEntretien:"11/03/2024",dernierTravaux:"10/07/2024",dernierDepannage:"",heures:0},{puissance:"165 KVA",site:"Deferrisation le Blanc Buisson et VE035 - MARDILLY",entretien2025:"Oui",dernierEntretien:"",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"45 KVA",site:"Deferrisation le Blanc Buisson et VE035 - MARDILLY (MOBILE)",entretien2025:"Oui",dernierEntretien:"",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"25 KVA",site:"STEP de Falaise",entretien2025:"Oui",dernierEntretien:"06/01/2023",dernierTravaux:"27/02/2025",dernierDepannage:"",heures:0},{puissance:"1650 KVA",site:"Production du Tanet",entretien2025:"Oui",dernierEntretien:"11/09/2024",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"40 KVA",site:"STEP de Beaumont le Roger",entretien2025:"Oui",dernierEntretien:"12/09/2024",dernierTravaux:"",dernierDepannage:"",heures:0},{puissance:"66 KVA",site:"PR n4 la Mancellerie - Bourg-Achard",entretien2025:"Oui",dernierEntretien:"03/04/2024",dernierTravaux:"28/11/2024",dernierDepannage:"",heures:0}]}},saveData(){localStorage.setItem("saur_interventions",JSON.stringify(this.data.interventions)),localStorage.setItem("saur_messages",JSON.stringify(this.data.messages)),localStorage.setItem("saur_activities",JSON.stringify(this.data.activities)),localStorage.setItem("saur_settings",JSON.stringify(this.data.settings))},showPage(t){if("parametres"===t&&"Florent BEAUCHER"!==this.currentUser)return void this.showNotification("fa-lock","Acc√®s refus√©","Seul l'administrateur peut acc√©der aux param√®tres");this.currentPage=t,document.querySelectorAll(".page").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".menu-item").forEach(t=>t.classList.remove("active")),document.getElementById(t).classList.add("active"),event.target.closest(".menu-item").classList.add("active"),this.render()},render(){switch(this.currentPage){case"dashboard":this.renderDashboard();break;case"interventions":this.renderInterventions();break;case"archives":this.renderArchives();break;case"groupes":this.renderGE();break;case"parametres":this.renderParametres()}},renderDashboard(){const t=this.data.interventions.filter(t=>!t.archive).length,e=this.data.interventions.filter(t=>!t.archive&&"Critique"===t.priorite).length,a=this.data.interventions.filter(t=>!t.archive&&"En cours"===t.statut).length,s=this.data.interventions.filter(t=>!t.archive&&"Termin√©"===t.statut).length;document.getElementById("statsGrid").innerHTML=`\n            <div class="stat-card"><h3>${t}</h3><p><i class="fas fa-wrench"></i> Total FIM</p></div>\n            <div class="stat-card"><h3>${e}</h3><p><i class="fas fa-exclamation-triangle"></i> Critiques</p></div>\n            <div class="stat-card"><h3>${a}</h3><p><i class="fas fa-hourglass-half"></i> En cours</p></div>\n            <div class="stat-card"><h3>${s}</h3><p><i class="fas fa-check-circle"></i> Termin√©es</p></div>\n        `;const i=this.data.interventions.filter(t=>!t.archive&&"Critique"===t.priorite);document.getElementById("criticalInterventions").innerHTML=0===i.length?'<p style="color: #22c55e;"><i class="fas fa-check-circle"></i> Aucune intervention critique</p>':i.map(t=>`\n                <div style="padding: 12px; background: #fef2f2; border-left: 4px solid #dc2626; border-radius: 6px; margin-bottom: 12px;">\n                    <div style="display: flex; justify-content: space-between; align-items: center;">\n                        <div>\n                            <strong>${t.fim}</strong> - ${t.site} - ${t.materiel}\n                            <div style="color: #64748b; font-size: 12px; margin-top: 4px;">${t.probleme}</div>\n                        </div>\n                        <span class="badge priority-critique">CRITIQUE</span>\n                    </div>\n                </div>\n            `).join("")},renderInterventions(){const t=(document.getElementById("searchIntervention")?.value.toLowerCase()||""),e=document.getElementById("filterType")?.value||"",a=document.getElementById("filterPriorite")?.value||"",s=document.getElementById("filterStatut")?.value||"",i=document.getElementById("filterSecteur")?.value||"";let r=this.data.interventions.filter(t=>!t.archive);t&&(r=r.filter(e=>e.fim.toLowerCase().includes(t)||e.site.toLowerCase().includes(t)||e.materiel.toLowerCase().includes(t)||e.libelle.toLowerCase().includes(t))),e&&(r=r.filter(t=>t.type===e)),a&&(r=r.filter(t=>t.priorite===a)),s&&(r=r.filter(t=>t.statut===s)),i&&(r=r.filter(t=>t.secteur===i)),document.getElementById("fimCount").textContent=`(${r.length})`,document.getElementById("interventionsBody").innerHTML=r.map(t=>`\n            <tr>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'fim', this, 'text')">${t.fim}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'libelle', this, 'text')">${t.libelle}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'site', this, 'text')">${t.site}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'materiel', this, 'text')">${t.materiel}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'type', this, 'select')">${t.type}</span></td>\n                <td><span class="badge priority-${t.priorite.toLowerCase()} editable-cell" onclick="app.editCell(${t.id}, 'priorite', this, 'select')">${t.priorite}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'statut', this, 'select')">${t.statut}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'secteur', this, 'select')">${t.secteur}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'ordonnanceur', this, 'select')">${t.ordonnanceur||"---"}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'agents', this, 'text')">${t.agents||"---"}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'dateSignalement', this, 'date')">${this.formatDate(t.dateSignalement)}</span></td>\n                <td><span class="editable-cell" onclick="app.editCell(${t.id}, 'dateRealisation', this, 'date')">${this.formatDate(t.dateRealisation)}</span></td>\n                <td>\n                    <button class="btn-icon btn-edit" onclick="app.openEditModal(${t.id})" title="Modifier"><i class="fas fa-edit"></i></button>\n                    <button class="btn-icon btn-archive" onclick="app.archiveItem(${t.id})" title="Archiver"><i class="fas fa-archive"></i></button>\n                </td>\n            </tr>\n        `).join("")},editCell(t,e,a,s){if("Florent BEAUCHER"!==this.currentUser)return void this.showNotification("fa-lock","Acc√®s refus√©","Seul l'administrateur peut modifier");const i=this.data.interventions.find(e=>e.id===t);if(!i)return;const r=a.textContent;let n;if("select"===s){let t=[];n=document.createElement("select"),"type"===e?t=["EU","AEP"]:"priorite"===e?t=["Critique","Haute","Moyenne","Basse"]:"statut"===e?t=["En pr√©paration","En attente","En cours","Termin√©"]:"secteur"===e?t=["Cotentin","Bessin","Sud Manche"]:"ordonnanceur"===e&&(t=["---","Aur√©lie LEFRANCOIS","Christophe ROTH"]),n.innerHTML=t.map(t=>`<option value="${t}" ${t===r?"selected":""}>${t}</option>`).join("")}else"date"===s?(n=document.createElement("input"),n.type="date",n.value=i[e]||""):(n=document.createElement("input"),n.type="text",n.value=r);n.style.width="100%",n.style.padding="8px",n.style.border="2px solid #3b82f6",n.style.borderRadius="4px";const o=()=>{i[e]=n.value,i.updatedAt=(new Date).toISOString(),i.updatedBy=this.currentUser,this.saveData(),this.render(),this.addActivity("fa-edit","Modification",`${e} modifi√© sur FIM ${i.fim}`),this.showNotification("fa-check","Modifi√©",`${e} mis √† jour`)},d=()=>{this.render()};n.onblur=o,n.onkeydown=t=>{"Enter"===t.key&&o(),"Escape"===t.key&&d()},"select"===s&&(n.onchange=o),a.innerHTML="",a.appendChild(n),n.focus()},openModal(){document.getElementById("modalTitle").innerHTML='<i class="fas fa-plus-circle"></i> Nouvelle FIM',document.getElementById("interventionForm").reset(),document.getElementById("editingId").value="",document.getElementById("modal").classList.add("active")},openEditModal(t){const e=this.data.interventions.find(e=>e.id===t);if(!e)return;document.getElementById("modalTitle").innerHTML='<i class="fas fa-edit"></i> Modifier FIM '+e.fim,document.getElementById("editingId").value=t,document.getElementById("fim").value=e.fim,document.getElementById("libelle").value=e.libelle,document.getElementById("site").value=e.site,document.getElementById("materiel").value=e.materiel,document.getElementById("type").value=e.type,document.getElementById("priorite").value=e.priorite,document.getElementById("statut").value=e.statut,document.getElementById("secteur").value=e.secteur,document.getElementById("ordonnanceur").value=e.ordonnanceur,document.getElementById("dateSignalement").value=e.dateSignalement||"",document.getElementById("datePlanifiee").value=e.datePlanifiee||"",document.getElementById("dateRealisation").value=e.dateRealisation||"",document.getElementById("probleme").value=e.probleme||"",document.getElementById("compteRendu").value=e.compteRendu||"";const a=document.getElementById("agents"),s=e.agents?e.agents.split(", "):[];Array.from(a.options).forEach(t=>{t.selected=s.includes(t.value)}),document.getElementById("modal").classList.add("active")},closeModal(){document.getElementById("modal").classList.remove("active")},saveIntervention(t){t.preventDefault();const e=document.getElementById("editingId").value,a=document.getElementById("agents"),s=Array.from(a.selectedOptions).map(t=>t.value).join(", "),i={fim:document.getElementById("fim").value,libelle:document.getElementById("libelle").value,site:document.getElementById("site").value,materiel:document.getElementById("materiel").value,type:document.getElementById("type").value,priorite:document.getElementById("priorite").value,statut:document.getElementById("statut").value,secteur:document.getElementById("secteur").value,ordonnanceur:document.getElementById("ordonnanceur").value,agents:s,dateSignalement:document.getElementById("dateSignalement").value,datePlanifiee:document.getElementById("datePlanifiee").value,dateRealisation:document.getElementById("dateRealisation").value,probleme:document.getElementById("probleme").value,compteRendu:document.getElementById("compteRendu").value,archive:!1};if(e){const t=this.data.interventions.find(t=>t.id==e);Object.assign(t,i),t.updatedAt=(new Date).toISOString(),t.updatedBy=this.currentUser,this.addActivity("fa-edit","FIM modifi√©e",`FIM ${i.fim} mise √† jour`),this.showNotification("fa-check","Modifi√©","FIM mise √† jour avec succ√®s")}else{const t={...i,id:Date.now(),createdAt:(new Date).toISOString(),createdBy:this.currentUser,updatedAt:(new Date).toISOString(),updatedBy:this.currentUser};this.data.interventions.unshift(t),this.addActivity("fa-plus-circle","FIM cr√©√©e",`Nouvelle FIM ${i.fim}`),this.showNotification("fa-check","Cr√©√©e","FIM cr√©√©e avec succ√®s")}this.saveData(),this.closeModal(),this.render()},archiveItem(t){if(!confirm("Archiver cette FIM ?"))return;const e=this.data.interventions.find(e=>e.id===t);e.archive=!0,e.updatedAt=(new Date).toISOString(),e.updatedBy=this.currentUser,this.saveData(),this.render(),this.addActivity("fa-archive","FIM archiv√©e",`FIM ${e.fim} archiv√©e`),this.showNotification("fa-archive","Archiv√©","FIM archiv√©e avec succ√®s")},renderArchives(){const t=document.getElementById("searchArchive")?.value.toLowerCase()||"";let e=this.data.interventions.filter(t=>t.archive);t&&(e=e.filter(e=>e.fim.toLowerCase().includes(t)||e.site.toLowerCase().includes(t)||e.materiel.toLowerCase().includes(t))),document.getElementById("archivesBody").innerHTML=e.map(t=>`\n            <tr>\n                <td>${t.fim}</td>\n                <td>${t.site}</td>\n                <td>${t.materiel}</td>\n                <td>${t.type}</td>\n                <td>${this.formatDate(t.dateRealisation)}</td>\n                <td>\n                    <button class="btn-icon" style="background: #22c55e; color: white;" onclick="app.restoreItem(${t.id})" title="Restaurer">\n                        <i class="fas fa-undo"></i>\n                    </button>\n                </td>\n            </tr>\n        `).join("")},restoreItem(t){const e=this.data.interventions.find(e=>e.id===t);e.archive=!1,this.saveData(),this.render(),this.addActivity("fa-undo","FIM restaur√©e",`FIM ${e.fim} restaur√©e`),this.showNotification("fa-check","Restaur√©","FIM restaur√©e avec succ√®s")},showGE(t){this.currentGE=t,document.querySelectorAll(".ge-tab").forEach(t=>t.classList.remove("active")),event.target.classList.add("active"),this.renderGE()},renderGE(){const t=this.data.groupesElectrogenes[this.currentGE]||[];document.getElementById("geBody").innerHTML=t.map(t=>{let e="ge-badge-oui",a=t.entretien2025;return"Fait"===t.entretien2025?e="ge-badge-fait":"En cours"===t.entretien2025?e="ge-badge-encours":"Non"===t.entretien2025&&(e="ge-badge-non"),`\n                <tr>\n                    <td><strong>${t.puissance}</strong></td>\n                    <td>${t.site}</td>\n                    <td><span class="ge-badge ${e}">${a}</span></td>\n                    <td>${t.dernierEntretien||"-"}</td>\n                    <td>${t.dernierTravaux||"-"}</td>\n                    <td>${t.dernierDepannage||"-"}</td>\n                    <td>\n                        <span class="editable-cell" onclick="app.editGEHeures('${this.currentGE}', '${t.site}', this)">\n                            ${t.heures}h\n                        </span>\n                    </td>\n                </tr>\n            `}).join("")},editGEHeures(t,e,a){if("Florent BEAUCHER"!==this.currentUser)return void this.showNotification("fa-lock","Acc√®s refus√©","Seul l'administrateur peut modifier");const s=this.data.groupesElectrogenes[t].find(t=>t.site===e),i=document.createElement("input");i.type="number",i.value=s.heures,i.style.width="80px",i.style.padding="4px",i.style.border="2px solid #3b82f6",i.style.borderRadius="4px";const r=()=>{s.heures=parseInt(i.value)||0,this.saveData(),this.renderGE(),this.addActivity("fa-tachometer-alt","Heures mises √† jour",`${e}: ${s.heures}h`)};i.onblur=r,i.onkeydown=t=>{"Enter"===t.key&&r(),"Escape"===t.key&&this.renderGE()},a.innerHTML="",a.appendChild(i),i.focus()},renderParametres(){"Florent BEAUCHER"!==this.currentUser?document.getElementById("parametresContent").innerHTML=`\n                <div class="card">\n                    <div style="text-align: center; padding: 40px; color: #dc2626;">\n                        <i class="fas fa-lock" style="font-size: 48px; margin-bottom: 16px;"></i>\n                        <h2>Acc√®s Restreint</h2>\n                        <p>Seul l'administrateur peut acc√©der aux param√®tres.</p>\n                    </div>\n                </div>\n            `:document.getElementById("parametresContent").innerHTML=`\n            <div class="card">\n                <h2 style="margin-bottom: 20px; color: #0066b3;"><i class="fas fa-user"></i> Mon Compte</h2>\n                <div class="form-group">\n                    <label>Utilisateur connect√©</label>\n                    <select onchange="app.changeUser(this.value)">\n                        <option value="Florent BEAUCHER" selected>Florent BEAUCHER (Admin)</option>\n                        <option value="Aur√©lie LEFRANCOIS">Aur√©lie LEFRANCOIS</option>\n                        <option value="Christophe ROTH">Christophe ROTH</option>\n                        <option value="Guillaume DEGRUGILLIER">Guillaume DEGRUGILLIER</option>\n                        <option value="Antoine DUMAS">Antoine DUMAS</option>\n                        <option value="Guillaume SAUVAGET">Guillaume SAUVAGET</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class="card">\n                <h2 style="margin-bottom: 20px; color: #0066b3;"><i class="fas fa-bell"></i> Notifications</h2>\n                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 12px;">\n                    <span>Notifications activ√©es</span>\n                    <input type="checkbox" ${this.data.settings.notifications?"checked":""} onchange="app.toggleSetting('notifications')">\n                </div>\n                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 8px;">\n                    <span>Feed activit√© visible</span>\n                    <input type="checkbox" ${this.data.settings.activityFeed?"checked":""} onchange="app.toggleSetting('activityFeed')">\n                </div>\n            </div>\n\n            <div class="card">\n                <h2 style="margin-bottom: 20px; color: #0066b3;"><i class="fas fa-download"></i> Sauvegarde</h2>\n                <div style="display: flex; gap: 12px; flex-wrap: wrap;">\n                    <button class="btn btn-primary" onclick="app.exportData()">\n                        <i class="fas fa-file-excel"></i> Export Excel\n                    </button>\n                    <button class="btn btn-secondary" onclick="app.exportFullBackup()">\n                        <i class="fas fa-download"></i> Export Backup\n                    </button>\n                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">\n                        <i class="fas fa-upload"></i> Import Backup\n                    </button>\n                    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="app.importBackup(this)">\n                </div>\n            </div>\n\n            <div class="card" style="border: 2px solid #dc2626;">\n                <h2 style="margin-bottom: 20px; color: #dc2626;"><i class="fas fa-exclamation-triangle"></i> Zone de Danger</h2>\n                <button class="btn btn-danger" onclick="if(confirm('Supprimer TOUTES les donn√©es ?')) app.resetData()">\n                    <i class="fas fa-trash"></i> R√©initialiser\n                </button>\n            </div>\n        `},changeUser(t){this.currentUser=t,this.addActivity("fa-user","Utilisateur chang√©",`Connect√© en tant que ${t}`),this.showNotification("fa-user","Utilisateur chang√©",t)},toggleSetting(t){this.data.settings[t]=!this.data.settings[t],this.saveData(),"activityFeed"===t&&this.toggleActivityFeed(),this.showNotification("fa-check","Param√®tre modifi√©",`${t} ${this.data.settings[t]?"activ√©":"d√©sactiv√©"}`)},exportData(){const t="FIM;Site;Mat√©riel;Type;Priorit√©;Statut;Secteur;Ordonnanceur;Agents;Date Signal;Date R√©alis\n"+this.data.interventions.filter(t=>!t.archive).map(t=>`${t.fim};${t.site};${t.materiel};${t.type};${t.priorite};${t.statut};${t.secteur};${t.ordonnanceur};${t.agents};${t.dateSignalement};${t.dateRealisation}`).join("\n"),e=new Blob(["√Ø¬ª¬ø"+t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=`SAUR_MANCHE_${(new Date).toISOString().split("T")[0]}.csv`,a.click(),this.showNotification("fa-download","Export r√©ussi","Fichier Excel t√©l√©charg√©")},exportFullBackup(){const t=JSON.stringify(this.data,null,2),e=new Blob([t],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=`SAUR_BACKUP_${(new Date).toISOString().split("T")[0]}.json`,a.click(),this.showNotification("fa-download","Backup cr√©√©","Sauvegarde compl√®te export√©e")},importBackup(t){const e=t.files[0];if(!e)return;const a=new FileReader;a.onload=t=>{try{this.data=JSON.parse(t.target.result),this.saveData(),this.render(),this.showNotification("fa-upload","Import r√©ussi","Donn√©es restaur√©es")}catch(t){alert("Erreur lors de l'import")}},a.readAsText(e)},resetData(){this.data.interventions=[],this.data.activities=[],this.saveData(),this.render(),this.renderActivityFeed(),this.showNotification("fa-trash","R√©initialis√©","Donn√©es supprim√©es")},addActivity(t,e,a){const s={icon:t,title:e,message:a,user:this.currentUser,timestamp:(new Date).toISOString()};this.data.activities.unshift(s),this.data.activities.length>50&&(this.data.activities=this.data.activities.slice(0,50)),this.saveData(),this.renderActivityFeed()},renderActivityFeed(){const t=this.data.settings.activityFeed,e=document.getElementById("activityFeed");t?e.classList.add("active"):e.classList.remove("active"),document.getElementById("activityList").innerHTML=this.data.activities.map(t=>`\n            <div class="activity-item">\n                <div class="activity-item-header">\n                    <i class="fas ${t.icon}"></i>\n                    <span class="activity-item-title">${t.title}</span>\n                </div>\n                <div class="activity-item-message">${t.message}</div>\n                <div class="activity-item-meta">\n                    <span><i class="fas fa-user"></i> ${t.user}</span>\n                    <span>${this.formatTime(t.timestamp)}</span>\n                </div>\n            </div>\n        `).join("")},toggleActivityFeed(){this.data.settings.activityFeed=!this.data.settings.activityFeed,this.saveData(),this.renderActivityFeed()},toggleChat(){this.chatOpen=!this.chatOpen;const t=document.getElementById("chatWindow");this.chatOpen?(t.classList.add("active"),document.getElementById("chatInput").focus()):t.classList.remove("active")},renderChat(){document.getElementById("chatMessages").innerHTML=this.data.messages.map(t=>`\n            <div class="message">\n                <div class="message-author"><i class="fas fa-user"></i> ${t.author}</div>\n                <div class="message-content">${t.text}</div>\n            </div>\n        `).join("");const t=document.getElementById("chatMessages");t.scrollTop=t.scrollHeight},sendMessage(){const t=document.getElementById("chatInput"),e=t.value.trim();if(!e)return;const a={author:this.currentUser,text:e,timestamp:(new Date).toISOString()};this.data.messages.push(a),this.saveData(),this.renderChat(),this.addActivity("fa-comment","Message envoy√©",e.substring(0,50)),t.value=""},showNotification(t,e,a){if(!this.data.settings.notifications)return;const s=document.getElementById("notification");s.innerHTML=`\n            <div class="notification-header">\n                <i class="fas ${t} notification-icon"></i>\n                <span class="notification-title">${e}</span>\n            </div>\n            <div class="notification-message">${a}</div>\n        `,s.classList.add("active"),setTimeout(()=>{s.classList.remove("active")},4e3)},formatDate(t){if(!t)return"-";return new Date(t).toLocaleDateString("fr-FR")},formatTime(t){const e=new Date,a=new Date(t),s=Math.floor((e-a)/1e3);return s<60?"√Ä l'instant":s<3600?`Il y a ${Math.floor(s/60)} min`:s<86400?`Il y a ${Math.floor(s/3600)}h`:a.toLocaleDateString("fr-FR")}};window.addEventListener("DOMContentLoaded",()=>{app.init()});
</script>
</body>
</html>